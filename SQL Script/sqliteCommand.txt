.mode csv
.headers on
.separator ,

.import playdata.csv playdata
.import PLAY_KIND.csv playkind

create table playdata2 
	as select playdata.*, playkind.name as actionName from playdata
	inner join playkind on playdata.アクションID = playkind.アクションID;

create table attack 
	as select 試合ID, 攻撃番号 from playdata 
	where not 攻撃番号 = 0 
	group by 試合ID, 攻撃番号 
	order by rowid;

select
	playdata2.試合ID as matchID,
	playdata2.攻撃番号 as attackNo,
	playdata2.履歴No as historyID,
	playdata2.試合状態ID as matchState,
	playdata2.絶対時間 as time,
	playdata2.絶対時間ミリ秒 as mtime,
	playdata2.チームID as teamID,
	playdata2.選手ID as playerID,
	playdata2.ホームアウェイF as homeaway,
	playdata2.ボールＸ as ballX,
	playdata2.ボールＹ as ballY,
	attack.rowid as attackID,
	"HOTZONE6-9" as hotzone,
	case when アクションID = 29 then "Pass_"||展開力||"_"||F_成功
		when アクションID = 30 then "Pass_"||展開力||"_"||F_成功
		else actionName
		end  as actionWord
from playdata2
inner join attack
	on playdata2.試合ID||playdata2.攻撃番号 = attack.試合ID||attack.攻撃番号;


